<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chicken Cam</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const ChickenCam = () => {
            const [isAudioDetected, setIsAudioDetected] = React.useState(false);
            const [isSetupComplete, setIsSetupComplete] = React.useState(false);
            const audioContextRef = React.useRef(null);
            const analyserRef = React.useRef(null);
            const mediaStreamRef = React.useRef(null);

            React.useEffect(() => {
                const setupAudio = async () => {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        mediaStreamRef.current = stream;

                        audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                        const source = audioContextRef.current.createMediaStreamSource(stream);
                        analyserRef.current = audioContextRef.current.createAnalyser();
                        analyserRef.current.fftSize = 256;
                        source.connect(analyserRef.current);

                        const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount);
                        const checkAudio = () => {
                            analyserRef.current.getByteFrequencyData(dataArray);
                            const audioLevel = dataArray.reduce((a, b) => a + b) / dataArray.length;
                            setIsAudioDetected(audioLevel > 30);
                            requestAnimationFrame(checkAudio);
                        };
                        checkAudio();
                        setIsSetupComplete(true);
                    } catch (error) {
                        console.error('Error accessing microphone:', error);
                    }
                };

                setupAudio();

                return () => {
                    if (mediaStreamRef.current) {
                        mediaStreamRef.current.getTracks().forEach(track => track.stop());
                    }
                    if (audioContextRef.current) {
                        audioContextRef.current.close();
                    }
                };
            }, []);

            return (
                <div className="relative w-full max-w-lg mx-auto p-4">
                    <div className="relative aspect-video bg-gray-100 rounded-lg overflow-hidden">
                        <img
                            src="https://raw.githubusercontent.com/your-username/your-repo/main/chicken.png"
                            alt="Chicken avatar"
                            className={`w-full h-full object-contain transition-transform duration-200 ${
                                isAudioDetected ? 'scale-110' : 'scale-100'
                            }`}
                        />
                        
                        {!isSetupComplete && (
                            <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 text-white">
                                <p>Setting up audio detection...</p>
                            </div>
                        )}

                        <div className={`absolute bottom-4 right-4 w-4 h-4 rounded-full transition-colors duration-200 ${
                            isAudioDetected ? 'bg-green-500' : 'bg-red-500'
                        }`} />
                    </div>
                </div>
            );
        };

        ReactDOM.render(<ChickenCam />, document.getElementById('root'));
    </script>
</body>
</html>
